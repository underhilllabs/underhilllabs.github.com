--- 
name: up-home-setting-up-lending-library-with
layout: post
title: Setting Up a Web Enabled Lending Library
tags: android java 
category: Android
---
<div id="content"><div id="outline-container-1" class="outline-2"><h3 id="sec-1">Setting Up a Web Enabled Lending Library </h3><br /><br /><div id="outline-container-1.1" class="outline-3"><div class="outline-text-3" id="text-1.1"><br /><p>I started cataloging books for a small community center's lending<br />library at librarything.com.  Librarything.com is a great web site<br />that I highly recommend.  If most of your books have ISBNs and you can<br />borrow someone's barcode scanner, cataloging books at Librarything is<br />a snap: on the "add books page" you scan a books ISBN and all of its<br />information (Title, Author, book cover) will be added by Librarything<br />for you.  Of course if you don't have a bar code scanner or there is<br />no ISBN, you simply type in part of the title or author and select the<br />book from a list of possible matches, this is a bit slower, but<br />perfectly adequate if you are inputting a smaller library.  <br /></p><p>Once all of the books are added, the social networking goodness<br />begins!  You're library has its own mini-site at Librarything, with a<br />publicly available catalog: <a href="http://librarything.com/catalog/buildupbooks">Build Up Books catalog</a> and profile:<br /><a href="http://librarything.com/profile/buildupbooks">Build Up Books profile</a>. So for a community center, you can send out the URL, and anyone can search the catalog for books they find of interest.  <br /></p><p>The one problem with this system, is there isn't a robust system for<br />checking out books.  Some libraries have adapted an informal system of<br />tagging books as "checked out" and in the private comments (only<br />visible to the administrator) added the borrowers contact<br />information.  This is somewhat acceptable, but first: you would have<br />to give any volunteers access to all of your Librarything account's<br />permissions (you get all or nothing as far admin rights goes on<br />Librarything).  Second there is no way to tell when the book was<br />checked out, when it is due back, and also no way to sort by which<br />books are currently overdue.  So I thought I would look into importing<br />the library, once cataloged, into a drupal web site.  <br /></p></div><br /></div><br /><div id="outline-container-1.2" class="outline-3"><h3 id="sec-1.2">Exporting Library from Librarything </h3><div class="outline-text-3" id="text-1.2"><br /><br /><p>Librarything has excellent importing and exporting facilities.  To<br />export, sign in to your account and then go to<br /><a href="http://librarything.com/more/import">http://librarything.com/more/import</a>.  On that page there are links for<br />downloading your catalog as either a comma separated csv file or a tab<br />delimited text file. <br /></p></div><br /></div><br /><div id="outline-container-1.3" class="outline-3"><h3 id="sec-1.3">Downloading User Uploaded Book Covers </h3><div class="outline-text-3" id="text-1.3"><br /><br /><p>Librarything has over 1,000,000 user uploaded book covers, and it<br />makes them available for free.  You need to a developer's key to<br />access them and there are some restrictions: you can only download<br />1000 per day and one per second. So with these understandable<br />restrictions, I decided it would be best to download the book covers<br />and store them locally.  So yesterday I wrote a python script to<br />download all of the book covers for our library.<br /></p></div><br /></div><br /><div id="outline-container-1.4" class="outline-3"><h3 id="sec-1.4">The Python Script </h3><div class="outline-text-3" id="text-1.4"><br /><br /><p>I will add a link at the bottom to the script on my<br /><a href="http://github.com/underhilllabs">Github Repository</a>.  So the script I wrote searches through a<br />librarything csv file, finds all of the ISBNs and downloads the book<br />covers from <a href="http://librarything.com">Librarything</a>.  <br /></p><br /><br /><br /><pre class="src src-python">import re, urllib, csv,time<br /><br />CSV_FILE ='~/Downloads/LibraryThing_export.csv'<br />IMG_DIR ='~/img/'<br />DEV_KEY = 'YOUR_LIBRARYTHING_DEV_KEY'<br />IMG_URL = "http://covers.librarything.com/devkey/" + DEV_KEY + "/large/isbn/"<br /></pre><br /><br /><br /><p>I use 4 python libraries.  <br /></p><ul><li>Re: for regular expressions to search for isbns.</li><li>urllib: for downloading the Book Cover from Librarything</li><li>csv: for creating a map data structure from a parsed csv file.</li><li>time: for limiting the downloads to one per second.</li></ul><br /><p>Also I add a couple of variables.  The important one to change is<br />DEV_KEY which contains your librarything developers key.  Also make<br />sure the CSV_FILE points at your downloaded CSV_FILE and the IMG_DIR<br />exists.  Finally IMG_URL points to the web service on librarything<br />where you can download user submitted book covers, all you need to do<br />is slap an ISBN on the end of that URL and the URL will return either<br />a book cover, or a clear 1x1 gif if they do not have that cover.  <br /></p><br /><br /><br /><code><pre class="src src-python"># read in the Librarything Export File<br />lt_dict = csv.DictReader(open(CSV_FILE))<br />#loop through the rows of the dictionary<br />for row in lt_dict:<br />    # grab the ISBN dictionary field<br />    mystr = row["'ISBN'"]<br />    # search for a matching ISBN<br />    mymatch = re.match(r"\[(\d+)\]",mystr)<br />    # if no match, print the title to STDOUT<br />    if mymatch is None:<br />        print "blank isbn for: %s" % row["'TITLE'"]<br />    else:<br />        # grab the matching string, this is our ISBN!<br />        isbn = mymatch.group(1)<br />        # build the web service request URL<br />        myurl = IMG_URL + isbn<br />        # where we will store the downloaded Book cover image<br />        myfile = "%slarge_%s" % (IMG_DIR,isbn)<br />        # urlretrieve downloads the image and stores it locally<br />        urllib.urlretrieve(myurl,myfile)<br />        print "myurl: %s, myfile: %s" % (myurl,myfile)<br />        # sleep for 2 seconds<br />        time.sleep(2)<br /></pre></code><br /><br /><br /><br /><p>The hard work is done by <a href="http://docs.python.org/library/csv.html#csv.DictReader">csv.DictReader</a> and <a href="http://docs.python.org/release/2.5.2/lib/module-urllib.html">urllib.urlretrieve</a>.<br />DictReader takes a csv file, parses the first line of the file for<br />field names and creates a dictionary data type, so you can loop<br />through the rows and have access to the fields by name.  Urlretrieve,<br />takes a URL and an optional file name and it grabs the file at the URL<br />and stores it locally as the filename you provided.  <br /></p><p>In a later blog post I will describe the Drupal end of this project:<br />creating a book CCK content type, importing data into Drupal custom<br />content types, and setting up the check out process.<br /></p></div></div></div></div><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/7035860407900002000-2092323799751063501?l=denverdroid.blogspot.com' alt='' /></div>
